---
title: "Fourier_Fall_Feats"
author: "James A. Coppock"
date: "10/15/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Load in Data

```{r}
#setwd("~/Desktop/Duke/Class/Fall 2020/Biomedical DS/BME590_Fall_Detection")
#install.packages("Rcpproll")
#install.packages("slider")
library(RcppRoll)
library(slider)
library(tibble)
library(purrr)
library(lubridate, warn.conflicts = FALSE)
library(dplyr, warn.conflicts = FALSE)
library(readxl)
library(evobiR)
library(patchwork)
library(gridExtra)
library(moments)
library(corrplot)
library(corrr)
library(signal)
Falls_df1 <- read.csv('Fall_Data1.csv')
Falls_df2 <- read.csv('Fall_Data2.csv')
Data  <- rbind(Falls_df1,Falls_df2)
Data_rms <- rbind(Falls_df1,Falls_df2)
rm(Falls_df1)
rm(Falls_df2)
```

## Including Plots


```{r}
cat('The Number of Falls in this Set of Data is:',(sum(Falls_df$Target)),'\n')
Fs <- 100
win <- 2
stp <- 0.5
window <-win*Fs
step <- stp*Fs

Falls_df <- subset(Data, Target==1)
noFalls_df<- subset(Data, Target==0)

```

```{r}
set.seed(97)
## 80% of the sample size
smp_size <- floor(0.80 * nrow(Falls_df))
falls_train_ind <- sample(seq_len(nrow(Falls_df)), size = smp_size)

Falls_train <- Falls_df[falls_train_ind, ]
Falls_test <- Falls_df[-falls_train_ind, ]


smp_size <- floor(0.80 * nrow(noFalls_df))
nofalls_train_ind <- sample(seq_len(nrow(noFalls_df)), size = smp_size)

noFalls_train <- Falls_df[nofalls_train_ind, ]
noFalls_test <- Falls_df[-nofalls_train_ind, ]

Train_df <- rbind(noFalls_train,Falls_train)
Test_df <- rbind(noFalls_test,Falls_test)
```

TRAIN BUTTERWORTH
```{r}
bf <- signal::butter(4, 1/49, type="low")
Time <- Train_df$Time
accX <- signal::filtfilt(bf, Train_df$accX)
accY <- signal::filtfilt(bf, Train_df$accY)
accZ <- signal::filtfilt(bf, Train_df$accZ)
  
angX <- signal::filtfilt(bf, Train_df$angX)
angY <- signal::filtfilt(bf, Train_df$angY)
angZ <- signal::filtfilt(bf, Train_df$angZ)
  
maxX <- signal::filtfilt(bf, Train_df$maxX)
magY <- signal::filtfilt(bf, Train_df$magY)
magZ <- signal::filtfilt(bf, Train_df$magZ)

Target <- Train_df$Target

Train_df <- data.frame(Time, accX, accY, accZ, angX, angY, angZ, maxX, magY, magZ, Target)
```

TEST BUTTERWORTH
```{r}
Time <- Test_df$Time
accX <- signal::filtfilt(bf, Test_df$accX)
accY <- signal::filtfilt(bf, Test_df$accY)
accZ <- signal::filtfilt(bf, Test_df$accZ)
  
angX <- signal::filtfilt(bf, Test_df$angX)
angY <- signal::filtfilt(bf, Test_df$angY)
angZ <- signal::filtfilt(bf, Test_df$angZ)
  
maxX <- signal::filtfilt(bf, Test_df$maxX)
magY <- signal::filtfilt(bf, Test_df$magY)
magZ <- signal::filtfilt(bf, Test_df$magZ)

Target <- Test_df$Target

Test_df <- data.frame(Time, accX, accY, accZ, angX, angY, angZ, maxX, magY, magZ, Target)
```


```{r}



apply(df,2,function(x) fft(as.numeric(x)))
bf <- signal::butter(4, 1/49, type="low")
accX <- signal::filtfilt(bf, Train_df$accX)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
